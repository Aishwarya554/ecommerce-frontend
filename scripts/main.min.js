function loadProducts(t){let e=document.getElementById("loading"),a=document.getElementById("error"),n=document.querySelector(".search-bar"),r=[];e.style.display="block",a.style.display="none";let s=localStorage.getItem("products");s&&(displayProducts(r=JSON.parse(s),t),e.style.display="none"),fetch("https://fakestoreapi.com/products").then(t=>t.json()).then(a=>{r=a,localStorage.setItem("products",JSON.stringify(a)),s||(displayProducts(a,t),e.style.display="none")}).catch(()=>{e.style.display="none",a.style.display="block"}),n&&n.addEventListener("input",e=>{let a=e.target.value.toLowerCase(),n=r.filter(t=>(t.title||"").toLowerCase().includes(a)||(t.category||"").toLowerCase().includes(a));displayProducts(n,t)})}function displayProducts(t,e){e.innerHTML="",t.forEach(t=>{let a=document.createElement("div");a.className="product-card",a.innerHTML=`
      <a href="product.html?id=${t.id}" class="product-link">
        <img data-src="${t.image}" alt="${t.title}" class="lazy-img">
        <h3>${t.title}</h3>
      </a>
      <p>$${t.price}</p>
      <button class="add-to-cart-btn">Add to Cart</button>
    `,e.appendChild(a)}),initLazyLoading()}function renderCart(t){let e=JSON.parse(localStorage.getItem("cart"))||[];if(e=e.map(t=>({...t,price:"string"==typeof t.price?parseFloat(t.price.replace(/[^0-9.]/g,"")):parseFloat(t.price),quantity:parseInt(t.quantity)||1})),t.innerHTML="",0===e.length){t.innerHTML="<p>Your cart is empty.</p>",updateCartCount();let a=document.getElementById("checkout-btn");a&&(a.disabled=!0);return}let n=0;e.forEach((e,a)=>{let r=e.price*e.quantity;n+=r;let s=document.createElement("div");s.className="cart-item",s.innerHTML=`
      <img src="${e.image}" alt="${e.name}" width="100" />
      <div class="cart-details">
        <h3>${e.name}</h3>
        <p>Price: ₹${e.price.toFixed(2)}</p>
        <div class="qty-controls">
          <button class="qty-btn decrease" data-index="${a}">−</button>
          <span class="qty">${e.quantity}</span>
          <button class="qty-btn increase" data-index="${a}">+</button>
        </div>
        <p class="item-total">Item Total: ₹${r.toFixed(2)}</p>
        <button class="remove-btn" data-index="${a}">Remove</button>
      </div>
    `,t.appendChild(s)});let r=document.createElement("div");r.id="total-price",r.innerHTML=`<h3>Total: ₹${n.toFixed(2)}</h3>`,t.appendChild(r);let s=document.getElementById("checkout-btn");s&&(s.disabled=!1,s.onclick=()=>{window.location.href="checkout.html"}),t.addEventListener("click",a=>{let n=a.target.dataset.index;void 0!==n&&(a.target.classList.contains("increase")?e[n].quantity++:a.target.classList.contains("decrease")?e[n].quantity>1&&e[n].quantity--:a.target.classList.contains("remove-btn")&&e.splice(n,1),localStorage.setItem("cart",JSON.stringify(e)),renderCart(t),updateCartCount())}),updateCartCount()}function updateCartCount(){let t=JSON.parse(localStorage.getItem("cart"))||[],e=document.querySelector(".cart-count")||document.getElementById("cart-count");if(e){let a=t.reduce((t,e)=>t+(e.quantity||1),0);e.textContent=a}}function initLazyLoading(){let t=document.querySelectorAll(".lazy-img");if("IntersectionObserver"in window){let e=new IntersectionObserver((t,e)=>{t.forEach(t=>{if(t.isIntersecting){let a=t.target;a.src=a.dataset.src,a.classList.remove("lazy-img"),e.unobserve(a)}})});t.forEach(t=>e.observe(t))}else t.forEach(t=>t.src=t.dataset.src)}console.log("Script loaded!"),document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("hamburger"),e=document.querySelector(".nav-links");t&&e&&t.addEventListener("click",()=>{e.classList.toggle("active"),t.classList.toggle("open")});let a=document.getElementById("product-grid");a&&loadProducts(a);let n=document.getElementById("cart-items-container");n&&renderCart(n),updateCartCount()}),document.addEventListener("click",t=>{if(t.target.classList.contains("add-to-cart-btn")){let e=t.target.closest(".product-card"),a=e.querySelector("h3").textContent,n=e.querySelector("p").textContent,r=e.querySelector("img").src,s={name:a,price:n,image:r,quantity:1},i=JSON.parse(localStorage.getItem("cart"))||[],c=i.findIndex(t=>t.name===s.name);-1!==c?i[c].quantity+=1:i.push(s),localStorage.setItem("cart",JSON.stringify(i)),updateCartCount();let l=document.getElementById("cart-message");l&&(l.classList.add("show"),setTimeout(()=>l.classList.remove("show"),2e3))}});